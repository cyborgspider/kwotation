/**
 * Plugin: jquery.zRSSFeed
 *
 * Version: 1.2.0
 * (c) Copyright 2010-2013, Zazar Ltd
 *
 * Description: jQuery plugin for display of RSS feeds via Google Feed API
 *              (Based on original plugin jGFeed by jQuery HowTo. Filesize function by Cary Dunn.)
 *
 * History:
 * 1.2.0 - Added month names to date formats
 * 1.1.9 - New dateformat option to allow feed date formatting
 * 1.1.8 - Added historical option to enable scoring in the Google Feed API
 * 1.1.7 - Added feed offset, link redirect & link content options
 * 1.1.6 - Added sort options
 * 1.1.5 - Target option now applies to all feed links
 * 1.1.4 - Added option to hide media and now compressed with Google Closure
 * 1.1.3 - Check for valid published date
 * 1.1.2 - Added user callback function due to issue with ajaxStop after jQuery 1.4.2
 * 1.1.1 - Correction to null xml entries and support for media with jQuery < 1.5
 * 1.1.0 - Added support for media in enclosure tags
 * 1.0.3 - Added feed link target
 * 1.0.2 - Fixed issue with GET parameters (Seb Dangerfield) and SSL option
 * 1.0.1 - Corrected issue with multiple instances
 *
 **/(function(e){e.fn.rssfeed=function(n,r,i){var s={limit:10,offset:1,header:!0,titletag:"h4",date:!0,dateformat:"datetime",content:!0,snippet:!0,media:!0,showerror:!0,errormsg:"",key:null,ssl:!1,linktarget:"_self",linkredirect:"",linkcontent:!1,sort:"",sortasc:!0,historical:!1},r=e.extend(s,r);return this.each(function(s,o){var u=e(o),a="";r.ssl&&(a="s");u.hasClass("rssFeed")||u.addClass("rssFeed");if(n==null)return!1;r.offset>0&&(r.offset-=1);r.limit+=r.offset;var f="http"+a+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(n);f+="&num="+r.limit;r.historical&&(f+="&scoring=h");r.key!=null&&(f+="&key="+r.key);f+="&output=json_xml";e.getJSON(f,function(n){if(n.responseStatus==200){t(o,n.responseData,r);e.isFunction(i)&&i.call(this,u)}else{if(r.showerror)if(r.errormsg!="")var s=r.errormsg;else var s=n.responseDetails;e(o).html('<div class="rssError"><p>'+s+"</p></div>")}})})};var t=function(t,i,s){var a=i.feed;if(!a)return!1;var f=[],l=0,c="",h="odd";if(s.media)var p=o(i.xmlString),d=p.getElementsByTagName("item");s.header&&(c+='<div class="rssHeader"><a href="'+a.link+'" title="'+a.description+'">'+a.title+"</a>"+"</div>");c+='<div class="rssBody"><ul>';for(var v=s.offset;v<a.entries.length;v++){l=v-s.offset;f[l]=[];var m=a.entries[v],g,y="",b=m.link;switch(s.sort){case"title":y=m.title;break;case"date":y=m.publishedDate}f[l].sort=y;if(m.publishedDate){var w=new Date(m.publishedDate),g=w.toLocaleDateString()+" "+w.toLocaleTimeString();switch(s.dateformat){case"datetime":break;case"date":g=w.toLocaleDateString();break;case"time":g=w.toLocaleTimeString();break;case"timeline":g=u(w);break;default:g=r(w,s.dateformat)}}s.linkredirect&&(b=encodeURIComponent(b));f[l].html="<"+s.titletag+'><a href="'+s.linkredirect+b+'" title="View this feed at '+a.title+'">'+m.title+"</a></"+s.titletag+">";s.date&&g&&(f[l].html+="<div>"+g+"</div>");if(s.content){if(s.snippet&&m.contentSnippet!="")var E=m.contentSnippet;else var E=m.content;s.linkcontent&&(E='<a href="'+s.linkredirect+b+'" title="View this feed at '+a.title+'">'+E+"</a>");f[l].html+="<p>"+E+"</p>"}if(s.media&&d.length>0){var S=d[v].getElementsByTagName("enclosure");if(S.length>0){f[l].html+='<div class="rssMedia"><div>Media files</div><ul>';for(var x=0;x<S.length;x++){var T=S[x].getAttribute("url"),N=S[x].getAttribute("type"),C=S[x].getAttribute("length");f[l].html+='<li><a href="'+T+'" title="Download this media">'+T.split("/").pop()+"</a> ("+N+", "+n(C)+")</li>"}f[l].html+="</ul></div>"}}}s.sort&&f.sort(function(e,t){if(s.sortasc)var n=e.sort,r=t.sort;else var n=t.sort,r=e.sort;if(s.sort=="date")return new Date(n)-new Date(r);n=n.toLowerCase();r=r.toLowerCase();return n<r?-1:n>r?1:0});e.each(f,function(e){c+='<li class="rssRow '+h+'">'+f[e].html+"</li>";h=="odd"?h="even":h="odd"});c+="</ul></div>";e(t).html(c);e("a",t).attr("target",s.linktarget)},n=function(e){var t=["bytes","kb","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(2)+" "+t[n]},r=function(e,t){var n=new Date(e);e=t;e=e.replace("dd",i(n.getDate()));e=e.replace("MMMM",s(n.getMonth()));e=e.replace("MM",i(n.getMonth()+1));e=e.replace("yyyy",n.getFullYear());e=e.replace("hh",i(n.getHours()));e=e.replace("mm",i(n.getMinutes()));e=e.replace("ss",i(n.getSeconds()));return e},i=function(e){e+="";e.length<2&&(e="0"+e);return e},s=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]},o=function(e){var t=navigator.appName,n;if(t=="Microsoft Internet Explorer"){n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(e)}else n=(new DOMParser).parseFromString(e,"text/xml");return n},u=function(e){var t=new Date,n=new Date(e),r=Math.round((t.getTime()-n.getTime())/1e3);if(r<60)return"< 1 min";if(r<3600)var i=Math.round(r/60)-1,s="min";else if(r<86400)var i=Math.round(r/3600)-1,s="hour";else if(r<604800)var i=Math.round(r/86400)-1,s="day";else var i=Math.round(r/604800)-1,s="week";i>1&&(s+="s");return i+" "+s}})(jQuery);